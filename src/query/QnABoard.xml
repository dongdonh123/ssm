<?xml version="1.0" encoding="UTF-8"?>


<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="ssm.cm.dao.QnABoardDao">
	
	<resultMap type="ssm.mi.vo.SmemberVO" id="SmemberVO">
	    <result property="ssNo" 			column="SS_NO"/>
	    <result property="ssName" 			column="SS_NAME"/>
	</resultMap>
	
	<resultMap type="ssm.cm.vo.QnABoardVO" id="qbVO">
	    <result property="qbNo" 			column="QB_NO"/>
	    <result property="qbTitle" 			column="QB_TITLE"/>
	    <result property="qbContents" 		column="QB_CONTENTS"/>
	    <result property="ssNo" 			column="SS_NO"/>
	    <result property="qbInsertdate" 	column="QB_INSERTDATE"/>
	    <result property="qbUpdatedate" 	column="QB_UPDATEDATE"/>
	    <result property="qbDeleteyn" 		column="QB_DELETEYN"/>
	    <result property="qbSecretyn" 		column="QB_SECRETYN"/>
	    <collection property="sMembervo" 	resultMap="SmemberVO"/>
	</resultMap>
	
	<sql id="qbCommon" >
		SELECT 
				A.QB_NO, 
				B.SS_NAME, 
				A.QB_TITLE, 
				A.QB_INSERTDATE
		FROM QNA_BOARD A, S_MEMBER B 
		WHERE QB_DELETEYN ='Y'
		AND A.SS_NO = B.SS_NO
		<trim prefix="AND" >
			<if test="search=='qbTitle' ">
				<![CDATA[QB_TITLE LIKE '%'|| #{keyword} ||'%']]>
			</if>
			<if test="search=='qbContents'">
				<![CDATA[QB_CONTENTS LIKE '%'|| #{keyword} ||'%']]>
			</if>
			<if test="search=='ssName'">
				<![CDATA[SS_NAME LIKE '%'|| #{keyword} ||'%']]>
			</if>
		</trim>
		ORDER BY A.QB_NO
	</sql>
	
	<select id ="qblist" parameterType="ssm.cm.vo.QnABoardVO" resultMap="qbVO">
			SELECT 
					QB_NO, 
					SS_NAME, 
					QB_TITLE, 
					QB_INSERTDATE
					
			FROM 
			  (	SELECT 
						list.*,
						ROWNUM AS RNUM
				FROM(<include refid="qbCommon"></include>
					)list
			)
	</select>
	
	<select id="qbChaebun" parameterType="ssm.cm.vo.QnABoardVO" resultMap="qbVO">
		
		SELECT
		TO_CHAR(NVL(MAX(SUBSTR(QB_NO,-4)),0)+1) QB_NO
		FROM QNA_BOARD
		
	</select>
	
	<insert id="qbInsert" parameterType="ssm.cm.vo.QnABoardVO">
	
		INSERT INTO QNA_BOARD(QB_NO,
							  SS_NO,
							  QB_TITLE,
							  QB_CONTENTS,
							  QB_DELETEYN,
							  QB_INSERTDATE,
							  QB_SECRETYN
							  )
		VALUES(#{qbNo},
			   #{ssNo},
			   #{qbTitle},
			   #{qbContents},
			   'Y',
			   SYSDATE,
			   #{qbSecretyn}
			   )
	
	</insert>
	
	<select id="pwdConfirm" parameterType="ssm.cm.vo.QnABoardVO" resultType="int">
		SELECT NVL((SELECT 1 FROM QNA_BOARD WHERE QB_NO = #{qbNo}),0)as result
		FROM dual
	</select>
	
	<update id="qbUpdate" parameterType="ssm.cm.vo.QnABoardVO">
	
		UPDATE QNA_BOARD SET 
								 QB_TITLE = #{qbTitle}
								,QB_CONTENTS = #{qbContents}
								,QB_UPDATEDATE = SYSDATE
								,QB_SECRETYN = #{qbSecretyn}
		WHERE 					 QB_NO = #{qbNo}						
		AND  					 QB_DELETEYN = 'Y'
	</update>
	
	<update id="qbDelete" parameterType="ssm.cm.vo.QnABoardVO">
	
		UPDATE QNA_BOARD SET 
								 QB_UPDATEDATE = SYSDATE
								,QB_DELETEYN = 'N' 
		WHERE 					 QB_NO = #{qbNo}						
		AND  					 QB_DELETEYN = 'Y'
	</update>
	
	<select id="qbDetail" parameterType="ssm.cm.vo.QnABoardVO" resultMap="qbVO">
		SELECT
				A.QB_NO, 
				B.SS_NAME, 
				A.QB_TITLE, 
				A.QB_CONTENTS, 
				A.QB_INSERTDATE, 
				A.QB_UPDATEDATE,
				A.QB_DELETEYN,
				A.QB_SECRETYN
		FROM QNA_BOARD A, S_MEMBER B
		WHERE QB_NO =#{qbNo}
		AND QB_DELETEYN='Y'
		AND A.SS_NO = B.SS_NO
	</select>
	
	<select id ="qbcount" parameterType="ssm.cm.vo.QnABoardVO" resultMap="qbVO">
		SELECT
		TO_CHAR(SUBSTR(QB_NO,-2))QB_NO
		FROM QNA_BOARD
        WHERE QB_DELETEYN ='Y'
        ORDER BY QB_NO
	</select>
	
</mapper>