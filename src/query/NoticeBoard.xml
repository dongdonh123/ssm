<?xml version="1.0" encoding="UTF-8"?>


<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="ssm.cm.dao.NoticeBoardDao">
	
	<resultMap type="ssm.mi.vo.TmemberVO" id="TmemberVO">
	    <result property="ttNo" 			column="TTNO"/>
	    <result property="ttName" 			column="TTNAME"/>
	</resultMap>
	
	<resultMap type="ssm.cm.vo.NoticeBoardVO" id="nbVO">
	    <result property="nbNo" 			column="NBNO"/>
	    <result property="nbTitle" 			column="NBTITLE"/>
	    <result property="nbContents" 		column="NBCONTENTS"/>
	    <result property="ttNo" 			column="TTNO"/>
	    <result property="nbFile" 			column="NBFILE"/>
	    <result property="nbInsertdate" 	column="NBINSERTDATE"/>
	    <result property="nbUpdatedate" 	column="NBUPDATEDATE"/>
	    <result property="nbDeleteyn" 		column="NBDELETEYN"/>
	    <collection property="tMembervo" 	resultMap="TmemberVO"/>
	</resultMap>
	
	<sql id="nbCommon" >
		SELECT 
				A.NBNO, 
				B.TTNAME, 
				A.NBTITLE, 
				A.NBINSERTDATE
		FROM NOTICE_BOARD A, T_MEMBER B 
		WHERE NBDELETEYN ='Y'
		AND A.TTNO = B.TTNO
		
		<trim prefix="AND" >
			<if test="search=='nbTitle' ">
				<![CDATA[NBTITLE LIKE '%'|| #{keyword} ||'%']]>
			</if>
			<if test="search=='nbContents'">
				<![CDATA[NBCONTENTS LIKE '%'|| #{keyword} ||'%']]>
			</if>
			<if test="search=='ttNo'">
				<![CDATA[TTNO LIKE '%'|| #{keyword} ||'%']]>
			</if>
		</trim>
	</sql>
	
	<select id ="nblist" parameterType="ssm.cm.vo.NoticeBoardVO" resultMap="nbVO">
			SELECT 
					NBNO, 
					TTNAME, 
					NBTITLE, 
					NBINSERTDATE
					
			FROM 
			  (	SELECT 
						list.*,
						ROWNUM AS RNUM
				FROM(<include refid="nbCommon"></include>
					)list
			)
	</select>
	
	<select id="nbChaebun" parameterType="ssm.cm.vo.NoticeBoardVO" resultMap="nbVO">
		
		SELECT
		TO_CHAR(NVL(MAX(SUBSTR(NBNO,-4)),0)+1) NBNO
		FROM NOTICE_BOARD
		
	</select>
	
	<insert id="nbInsert" parameterType="ssm.cm.vo.NoticeBoardVO">
	
		INSERT INTO NOTICE_BOARD(NBNO,TTNO,NBTITLE,NBCONTENTS,NBFILE,NBINSERTDATE,NBDELETEYN)
		VALUES(#{nbNo},#{ttNo},#{nbTitle},#{nbContents},#{nbFile},SYSDATE,'Y')
	
	</insert>
	
	<select id="pwdConfirm" parameterType="ssm.cm.vo.NoticeBoardVO" resultType="int">
		SELECT NVL((SELECT 1 FROM NOTICE_BOARD WHERE NBNO = #{nbNo}),0)as result
		FROM dual
	</select>
	
	<update id="nbUpdate" parameterType="ssm.cm.vo.NoticeBoardVO">
	
		UPDATE NOTICE_BOARD SET 
								 NBTITLE = #{nbTitle}
								,NBCONTENTS = #{nbContents}
								,NBFILE = #{nbFile}
								,NBUPDATEDATE = SYSDATE
		WHERE 					 NBNO = #{nbNo}						
		AND  					 NBDELETEYN = 'Y'
	</update>
	
	<update id="nbDelete" parameterType="ssm.cm.vo.NoticeBoardVO">
	
		UPDATE NOTICE_BOARD SET 
								 NBUPDATEDATE = SYSDATE
								,NBDELETEYN = 'N' 
		WHERE 					 NBNO = #{nbNo}						
		AND  					 NBDELETEYN = 'Y'
	</update>
	
	<select id="nbDetail" parameterType="ssm.cm.vo.NoticeBoardVO" resultMap="nbVO">
		SELECT
				A.NBNO, 
				B.TTNAME, 
				A.NBTITLE, 
				A.NBCONTENTS, 
				A.NBINSERTDATE, 
				A.NBUPDATEDATE,
				A.NBDELETEYN
		FROM NOTICE_BOARD A, T_MEMBER B
		WHERE NBNO =#{nbNo}
		AND NBDELETEYN='Y'
		AND A.TTNO = B.TTNO
	</select>
	
</mapper>